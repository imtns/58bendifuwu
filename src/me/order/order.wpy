<template>
  <view class="body">
    <view class="order-tabs-container">
       <tab :tabList="tabList" :spaceDistance="spaceDistance" :left="left"></tab>
       <view style="left:{{left}}rpx" class="order-tabs-underline"></view>
    </view>
    <view class="order-view">
      <scroll-view  lower-threshold="70" scroll-top="{{scrollValue}}" bindscrolltolower="reachBottom" style="height:91vh" scroll-y="true">
        <repeat for="{{orderList}}" key="index" index="index" item="item">
          <view class="order" wx:if="{{item.status == currentStatus}}">
              <view class="mod-order">
                <view class="order-orderNo"  data-shopid="{{item.shopId}}"  bindtap="goShop">
                  <view class="order-No">{{item.shopName}}</view>
                  <view class="order-status">进店<view class="arrow"></view></view>
                </view>
                <view class="order-line"></view>
                <view data-orderid="{{item.orderId}}" bindtap="goOrderDetail">
                  <view class="order-info">
                    <text class="order-info-title">服务名称: {{item.serviceType}}</text>
                    <text class="order-info-detail">服务时间: {{item.serviceTime}}</text>
                    <text class="order-info-detail">下单时间: {{item.orderTime}}</text>
                    <text class="order-info-detail order-info-detail-address">服务地址: {{item.serviceAddress}}</text>
                    <text class="order-info-detail">订单号: {{item.orderId}}</text>
                  </view>
                  <view class="order-line"></view>
                  <view class="order-price">
                    <text class="order-price-name">共计费用</text>
                    <text class="order-price-value">￥{{item.totalAmount}}</text>
                  </view>
                </view>
              </view>
            </view>
        </repeat>
      </scroll-view>
      <view class="order-empty" hidden="{{noOrder}}">
        <image class="order-empty-icon" src="../../image/empty.png"></image>
        <text>还没有订单</text>
      </view>
    </view>
  </view>
</template>
<script>
import wepy from 'wepy';
import Tab from '../../components/tabs';
import { get } from '../../utils/ajax';
import { GET_ORDERLIST } from '../../utils/url';
import { formatTime } from '../../utils/date';


const pageNum = 1;
const pageSize = 10;

export default class Order extends wepy.page {
  components = {
      tab: Tab,
  };
  data = {
      spaceDistance: 189,
      left: 60,
      scrollValue: 0,
      tabList: [
          {
              name: '待接单',
              id: 1,
              selected: true,
          },
          {
              name: '待服务',
              id: 2,
              selected: false,
          },
          {
              name: '已评价',
              id: 3,
              selected: false,
          },
          {
              name: '全部',
              id: 0,
              selected: false,
          },
      ],
      orderList: [],
      currentStatus: 1,
      noOrder: true,
  };
  events = {
      tabClick: value => {
          this.currentStatus = value.id;
          this.left = value.left;
      },
  };
  goShop(e) {
      const { shopid } = e.currentTarget.dataset;
      console.log(shopid);
      // wx.navigateTo({
      //   url: 'test?id=1'
      // })
  }
  goOrderDetail(e) {
      const orderId = e.currentTarget.dataset.orderid;
      console.log(orderId);
      wx.navigateTo({
          url: `orderDetail?orderId=${orderId}`,
      });
  }
  config = {
      navigationBarTitleText: '我的订单',
  };
  onLoad() {
      this.getOrder();
  }
  async getOrder() {
      try {
          const { data } = await get(GET_ORDERLIST, {
              pageSize,
              pageNum,
          });
          data.map(item => {
              item.orderTime = formatTime(item.orderTime, true);
              item.serviceTile = formatTime(item.serviceTile, true);
              return item;
          });
          this.orderList = data;
          this.$apply();
          console.log(data);
      } catch (e) {
          console.log(e);
      }
  }
}
</script>
<style>
.order-view {
  z-index: 1;
  position: relative;
  top: 108rpx;
}

.order-tabs {
  z-index: 99;
}
.order {
  margin-bottom: 20rpx;
}
.mod-order {
  background: white;
  display: flex;
  flex-wrap: wrap;
  flex-direction: column;
  padding: 0 30rpx;
  position: relative;
}

.order-orderNo {
  font-size: 28rpx;
  height: 88rpx;
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.order-No {
  float: left;
}

.order-status {
  color: #ff552e;
  float: right;
  margin-right: 10rpx;
}

.arrow {
  top: 45rpx;
}
.arrow::after {
  display: block;
  content: '';
  height: 23rpx;
  width: 23rpx;
  background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAWCAYAAAD0OH0aAAAANUlEQVR42mMwNDSc/T9U77+DgwMPAzEApBiGidKErGFU09DRRF0NJDlpVDFFsUl21BNbCAAAC6zb8PuVP8EAAAAASUVORK5CYII=')
    no-repeat;
  background-size: contain;
}
.order-line {
  position: relative;
  width: 110%;
  display: inline-block;
  background: rgb(236, 236, 236);
  height: 1rpx;
  margin: 0 -30rpx 1rpx;
}

.order-info {
  width: 100%;
}

.order-info-title {
  margin-top: 30rpx;
  font-size: 32rpx;
  width: 100%;
  font-weight: bold;
  display: inline-block;
  overflow: hidden;
}

.order-info-detail {
  width: 100%;
  display: inline-block;
  font-size: 28rpx;
  overflow: hidden;
}
.order-info-detail-address {
  width: 600rpx;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.order-price {
  font-size: 28rpx;
  display: flex;
  width: 100%;
  padding: 30rpx 0;
  align-items: center;
}

.order-price-name {
  flex: 1;
  text-align: left;
}

.order-price-value {
  flex: 1;
  font-size: 34rpx;
  color: #ff552e;
  text-align: right;
}
.order-empty {
  width: 100%;
  height: 100%;
  display: flex;
  margin-top: 200rpx;
  font-size: 30rpx;
  color: #ccc;
  justify-content: center;
  flex-wrap: wrap;
  flex-direction: column;
  align-items: center;
}
.order-empty-icon {
  width: 260rpx;
  height: 260rpx;
}
/*  加载更多   */

.weui-loading {
  margin: 0 5px;
  width: 20px;
  height: 20px;
  display: inline-block;
  vertical-align: middle;
  -webkit-animation: weuiLoading 1s steps(12, end) infinite;
  animation: weuiLoading 1s steps(12, end) infinite;
  background: transparent
    url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PHBhdGggZmlsbD0ibm9uZSIgZD0iTTAgMGgxMDB2MTAwSDB6Ii8+PHJlY3Qgd2lkdGg9IjciIGhlaWdodD0iMjAiIHg9IjQ2LjUiIHk9IjQwIiBmaWxsPSIjRTlFOUU5IiByeD0iNSIgcnk9IjUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTMwKSIvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjIwIiB4PSI0Ni41IiB5PSI0MCIgZmlsbD0iIzk4OTY5NyIgcng9IjUiIHJ5PSI1IiB0cmFuc2Zvcm09InJvdGF0ZSgzMCAxMDUuOTggNjUpIi8+PHJlY3Qgd2lkdGg9IjciIGhlaWdodD0iMjAiIHg9IjQ2LjUiIHk9IjQwIiBmaWxsPSIjOUI5OTlBIiByeD0iNSIgcnk9IjUiIHRyYW5zZm9ybT0icm90YXRlKDYwIDc1Ljk4IDY1KSIvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjIwIiB4PSI0Ni41IiB5PSI0MCIgZmlsbD0iI0EzQTFBMiIgcng9IjUiIHJ5PSI1IiB0cmFuc2Zvcm09InJvdGF0ZSg5MCA2NSA2NSkiLz48cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSIyMCIgeD0iNDYuNSIgeT0iNDAiIGZpbGw9IiNBQkE5QUEiIHJ4PSI1IiByeT0iNSIgdHJhbnNmb3JtPSJyb3RhdGUoMTIwIDU4LjY2IDY1KSIvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjIwIiB4PSI0Ni41IiB5PSI0MCIgZmlsbD0iI0IyQjJCMiIgcng9IjUiIHJ5PSI1IiB0cmFuc2Zvcm09InJvdGF0ZSgxNTAgNTQuMDIgNjUpIi8+PHJlY3Qgd2lkdGg9IjciIGhlaWdodD0iMjAiIHg9IjQ2LjUiIHk9IjQwIiBmaWxsPSIjQkFCOEI5IiByeD0iNSIgcnk9IjUiIHRyYW5zZm9ybT0icm90YXRlKDE4MCA1MCA2NSkiLz48cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSIyMCIgeD0iNDYuNSIgeT0iNDAiIGZpbGw9IiNDMkMwQzEiIHJ4PSI1IiByeT0iNSIgdHJhbnNmb3JtPSJyb3RhdGUoLTE1MCA0NS45OCA2NSkiLz48cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSIyMCIgeD0iNDYuNSIgeT0iNDAiIGZpbGw9IiNDQkNCQ0IiIHJ4PSI1IiByeT0iNSIgdHJhbnNmb3JtPSJyb3RhdGUoLTEyMCA0MS4zNCA2NSkiLz48cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSIyMCIgeD0iNDYuNSIgeT0iNDAiIGZpbGw9IiNEMkQyRDIiIHJ4PSI1IiByeT0iNSIgdHJhbnNmb3JtPSJyb3RhdGUoLTkwIDM1IDY1KSIvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjIwIiB4PSI0Ni41IiB5PSI0MCIgZmlsbD0iI0RBREFEQSIgcng9IjUiIHJ5PSI1IiB0cmFuc2Zvcm09InJvdGF0ZSgtNjAgMjQuMDIgNjUpIi8+PHJlY3Qgd2lkdGg9IjciIGhlaWdodD0iMjAiIHg9IjQ2LjUiIHk9IjQwIiBmaWxsPSIjRTJFMkUyIiByeD0iNSIgcnk9IjUiIHRyYW5zZm9ybT0icm90YXRlKC0zMCAtNS45OCA2NSkiLz48L3N2Zz4=)
    no-repeat;
  background-size: 100%;
}

.weui-loadmore {
  position: absolute;
  bottom: 0;
  width: 100%;
  font-size: 26rpx;
  text-align: center;
  padding: 6rpx 0;
  background: rgb(238, 238, 238);
}

.weui-loadmore__tips {
  display: inline-block;
  vertical-align: middle;
}
.order-tabs-container {
  border-top: 1px solid rgb(236, 236, 236);
  display: flex;
  height: 88rpx;
  align-items: center;
  background: white;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 2;
}
.order-tabs-underline {
  text-align: center;
  bottom: 0px;
  height: 4rpx;
  width: 60rpx;
  transition: 0.4s;
  position: absolute;
  background: rgb(248, 85, 47);
  transition: 0.4s;
}
</style>